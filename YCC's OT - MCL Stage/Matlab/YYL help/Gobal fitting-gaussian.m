% Gobal fitting
% 2018/7/19 first version by Yen-Chan Chang
% using mininize the total mean square error
close all
clear;clc
a=[31.65857
31.37354
32.89619
27.90481
32.79784
30.69654
32.14849
29.08421
35.37232
29.30907
17.57059
29.87656
32.2434
30.84973
35.47498
33.06681
24.76575
31.98533
34.87877
30.6509
29.20699
34.77905
34.06804
35.56201
32.00139
30.38732
34.17617
34.9624
22.03123
30.32171
27.99254
33.47042
36.54207
29.74389
29.00953
32.90347
24.09846
34.40778
33.70152
28.15958
32.78062
32.77301
35.71549
31.85284
30.19661
31.58789
33.71185
37.59629
30.40509
33.83234
33.56464
35.83501
36.82173
22.34298
34.54734
33.43334
35.6191
38.68705
35.72996
38.29062
34.80033
33.80352
34.06155
36.73876
35.11052
37.21766
36.01833
34.81461
34.91647
33.57888
35.19658
38.23414
36.24507
36.24743
37.8926
46.29277
34.26169
35.46388
33.20413
35.16598
36.58169
28.31274
33.73755
39.8472
34.49612
31.98058
34.2879
35.54581
35.50506
34.04919
35.35658
23.98953
34.3982
18.83325
37.37977
37.66096
36.84497
16.91052
38.85329
35.7015
36.7637
35.58445
35.8966
43.73845
42.7022
38.03246
41.88458
40.70733
44.93688
35.87385
43.24227
44.3868
35.68826
16.33404
16.33404
51.92826
44.04667
43.96419
34.97325
36.84711
];
b=[35.7657
33.87584
32.77341
35.76719
37.7269
34.39473
37.27475
34.7805
36.38666
34.78151
36.65702
36.40555
34.58772
18.15429
41.73216
33.37429
25.64115
33.14428
33.82161
34.84314
36.33812
17.6191
36.21839
35.23587
33.81541
13.05852
36.16217
32.2115
33.15548
34.15664
19.51809
32.79302
18.77192
37.43998
23.31803
37.64729
32.57827
33.18059
34.49747
32.42538
35.99784
34.39033
38.17019
36.13018
37.81732
36.67428
35.37018
43.97108
29.17998
33.91247
36.45785
34.80646
29.1015
34.18912
33.80019
34.4487
37.01226
35.74964
39.13438
37.78747
38.24049
33.10868
37.81125
32.13758
34.68045
33.28279
25.21318
34.44526
33.48808
32.04123
35.8896
36.4687
35.77107
56.77308
35.31094
37.0811
36.99215
32.67492
39.24479
29.99448
35.86165
16.89707
21.13538
32.32387
36.09126
34.43939
35.09678
];
c=[31.25127
31.42774
31.67567
33.21768
32.94414
33.89054
36.8304
34.81693
35.75064
32.16059
32.33492
26.04685
33.18422
36.02251
32.5533
29.96548
36.96647
33.99421
35.43876
31.12427
13.03834
36.01592
36.44347
31.99692
35.76848
36.6949
30.77363
33.14099
28.8958
31.88476
32.0092
29.82939
33.26204
32.92473
34.02778
35.09924
35.59128
14.13725
36.00817
36.98044
30.30308
31.50553
34.44677
26.80858
33.74571
33.43013
28.78751
35.6887
38.96614
35.67668
36.15963
32.44309
8.99096
33.20284
35.86692
34.93127
9.7548
36.64915
25.80242
35.07162
34.21993
36.58966
33.55178
36.15733
31.33614
34.10295
35.74952
36.0853
34.64887
10.39528
32.55596
35.22245
];
[y1,x1]=hist(a,20);
y1=y1/sum(y1)/(x1(2)-x1(1));
[y2,x2]=hist(b,20);
y2=y2/sum(y2)/(x2(2)-x2(1));
[y3,x3]=hist(c,20);
y3=y3/sum(y3)/(x3(2)-x3(1));

y=@(x,xm,sd) 1/sd/sqrt(2*pi)*exp(-(x-xm).^2/2/sd^2);


SS1=@(p) sum(((y1-y(x1,p(1),p(2))).^2))
SS2=@(p) sum(((y2-y(x2,p(1),p(2))).^2))
SS3=@(p) sum(((y3-y(x3,p(1),p(2))).^2))

SSS=@(p) SS1([p(1),p(2)])+SS2([p(1),p(3)])+SS3([p(1),p(4)])


 a=fminsearch(SS1,[35,2.9,2.5,2.9])

 y1best=y(x1,a(1),a(2));
 y2best=y(x2,a(1),a(3));
 y3best=y(x3,a(1),a(4));
  figure
plot(x1,y1,x2,y2,x3,y3,x1,y1best,'o',x2,y2best,'o',x3,y3best,'o')


